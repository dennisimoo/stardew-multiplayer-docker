#!/bin/sh
set -eu

CFG_DIR="/data/Stardew/Stardew Valley/Mods/AutoLoadGame"
CFG_FILE="$CFG_DIR/config.json"
TPL_FILE="$CFG_DIR/config.json.template"

# Ensure directory exists
mkdir -p "$CFG_DIR"

# If config is missing or empty, seed it from template or defaults
if [ ! -s "$CFG_FILE" ]; then
    if [ -f "$TPL_FILE" ]; then
        # If envsubst is available, render; otherwise copy template as-is
        if command -v envsubst >/dev/null 2>&1; then
            envsubst < "$TPL_FILE" > "$CFG_FILE"
        else
            cp "$TPL_FILE" "$CFG_FILE"
        fi
    else
        cat > "$CFG_FILE" <<'JSON'
{
  "LastFileLoaded": "null",
  "LoadIntoMultiplayer": true,
  "ForgetLastFileOnTitle": true
}
JSON
    fi
fi

# Relax permissions so the app can update it
chmod 777 "$CFG_FILE" || true
